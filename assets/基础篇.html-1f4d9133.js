import{_ as i}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as u,c as k,a as n,d as a,b as s,w as l,f as e}from"./app-3b91dcb7.js";const r="/assets/1653069893050-4b3ea782.png",d="/assets/1653323595206-be1b7881.png",m="/assets/1653327884526-1674300f.png",b="/assets/1653328022622-42d0fd7a.png",v={},y=e('<h1 id="基础篇" tabindex="-1"><a class="header-anchor" href="#基础篇" aria-hidden="true">#</a> 基础篇</h1><h2 id="认识缓存" tabindex="-1"><a class="header-anchor" href="#认识缓存" aria-hidden="true">#</a> 认识缓存</h2><p>缓存：一种具有高效读写能力的数据暂存区域</p><h2 id="缓存的作用" tabindex="-1"><a class="header-anchor" href="#缓存的作用" aria-hidden="true">#</a> 缓存的作用</h2><ol><li>降低后端的负载</li><li>提高服务的读写响应速度</li></ol><h2 id="缓存的成本" tabindex="-1"><a class="header-anchor" href="#缓存的成本" aria-hidden="true">#</a> 缓存的成本</h2><ul><li>开发成本</li><li>运维成本</li><li>数据一致性</li></ul><h3 id="短信验证码-实战" tabindex="-1"><a class="header-anchor" href="#短信验证码-实战" aria-hidden="true">#</a> 短信验证码-实战</h3><p>基于session的短信验证码登录，<strong>每个session保存在请求对应的tomcat服务器上</strong>，若在tomcat集群环境下则无法保证每次请求到同一个tomcat服务器上，即<strong>无法保证session数据共享</strong>。我们能如何解决这个问题呢？</p><p>早期的方案是<strong>session拷贝</strong>，就是说虽然每个tomcat上都有不同的session，但是每当任意一台服务器的session修改时，都会同步给其他的Tomcat服务器的session，这样的话，就可以实现session的共享了。</p><p>但是这种方案具有两个大<strong>问题</strong></p>',11),g=e('<p>所以咱们后来采用的方案都是<mark>基于redis来完成</mark>，我们把session换成redis，redis数据本身就是共享的，就可以避免session共享的问题了</p><figure><img src="'+r+'" alt="session共享问题" tabindex="0" loading="lazy"><figcaption>session共享问题</figcaption></figure><h2 id="缓存更新策略" tabindex="-1"><a class="header-anchor" href="#缓存更新策略" aria-hidden="true">#</a> 缓存更新策略</h2><ol><li>内存淘汰：Redis自带的内存淘汰机制</li><li>过期淘汰：利用expire命令给数据设置过期时间</li><li>主动更新：主动完成数据库与缓存的同时更新</li></ol>',4),f=n("ul",null,[n("li",null,"低一致性需求：选择内存淘汰或者过期淘汰策略"),n("li",null,"高一致性需求：选择主动更新 + 过期时间兜底")],-1),w=n("h2",{id:"主动更新的方案",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#主动更新的方案","aria-hidden":"true"},"#"),s(" 主动更新的方案")],-1),h=e('<blockquote><p>使用 <mark>Cache Aside</mark> 方案，先操作数据库还是先操作缓存<br><img src="'+d+'" alt="Cache Aside" loading="lazy"></p><ul><li><p>删除缓存还是更新缓存？</p><ul><li>更新缓存：每次更新数据库都更新缓存，无效写操作较多</li><li>删除缓存：更新数据库时让缓存失效，查询时再更新缓存</li></ul></li><li><p>如何保证缓存与数据库的操作的同时成功或失败？</p><ul><li>单体系统，将缓存与数据库操作放在一个事务</li><li>分布式系统，利用TCC等分布式事务方案</li></ul></li></ul><p>先操作缓存还是先操作数据库？</p><ul><li>先删除缓存，再操作数据库：在满足原子性的情况下，安全问题概率较低</li><li>先操作数据库，再删除缓存：安全问题概率较高</li></ul></blockquote>',1),x=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[s("  "),n("span",{class:"token comment"},"// 根据key查询redis，是否命中"),s(`
  `),n("span",{class:"token class-name"},"String"),s(" shopJson "),n("span",{class:"token operator"},"="),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cacheKey"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StrUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isNotBlank"),n("span",{class:"token punctuation"},"("),s("shopJson"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token comment"},"// redis命中，json转为obj返回"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBean"),n("span",{class:"token punctuation"},"("),s("shopJson"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`

  `),n("span",{class:"token comment"},"// redis未命中，查询db"),s(`
  `),n("span",{class:"token class-name"},"Object"),s(" object "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"getById"),n("span",{class:"token punctuation"},"("),s("id"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

  `),n("span",{class:"token comment"},"// db未命中，返回失败"),s(`
  `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("object "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
      `),n("span",{class:"token comment"},"// 未命中缓存空对象"),s(`
      stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cacheKey"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
      `),n("span",{class:"token comment"},"// 返回空对象"),s(`
      `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token punctuation"},"}"),s(`
  `),n("span",{class:"token comment"},"// db命中，存入redis，成功返回"),s(`
  stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cacheKey"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toJsonStr"),n("span",{class:"token punctuation"},"("),s("object"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  `),n("span",{class:"token comment"},"// 返回查询结果"),s(`
  `),n("span",{class:"token keyword"},"return"),s(" object"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),T=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[s("  "),n("span",{class:"token comment"},"// 更新数据库"),s(`
  `),n("span",{class:"token function"},"updateById"),n("span",{class:"token punctuation"},"("),s("shop"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  
  `),n("span",{class:"token comment"},"// 删除redis缓存"),s(`
  stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"delete"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"cacheKey"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
  
  `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),S=n("h2",{id:"缓存穿透",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#缓存穿透","aria-hidden":"true"},"#"),s(" 缓存穿透")],-1),R=n("p",null,"产生原因：客户端请求的数据在缓存中和数据库中都不存在，这样缓存永远不会生效，这些请求都会打到数据库",-1),U=n("p",null,"常见的解决方案有两种：",-1),D=n("p",null,"缓存空对象",-1),B=n("li",null,[s("思路：对于不存在的数据也"),n("strong",null,"在Redis建立缓存，值为空"),s("，并设置一个"),n("strong",null,"较短的TTL时间"),s("。")],-1),E=n("p",null,"布隆过滤",-1),j=n("li",null,[s("思路：利用"),n("strong",null,"布隆过滤器算法"),s("，在请求"),n("strong",null,"进入Redis之前先判断是否存在"),s("，如果不存在则直接拒绝请求。")],-1),C=n("li",null,[n("p",null,"其他"),n("ul",null,[n("li",null,"做好数据的基础格式校验"),n("li",null,"加强用户权限校验"),n("li",null,"做好热点参数的限流")])],-1),J=e('<h2 id="缓存雪崩" tabindex="-1"><a class="header-anchor" href="#缓存雪崩" aria-hidden="true">#</a> 缓存雪崩</h2><p>缓存雪崩是指在同一时段大量的缓存key同时失效或者Redis服务宕机，导致大量请求到达数据库，带来巨大压力。</p><figure><img src="'+m+'" alt="缓存雪崩" tabindex="0" loading="lazy"><figcaption>缓存雪崩</figcaption></figure><p>解决方案：</p><ul><li>给不同的Key的TTL添加随机值</li><li>利用Redis集群提高服务的可用性</li><li>给缓存业务添加降级限流策略</li><li>给业务添加多级缓存</li></ul><h2 id="缓存击穿-热点key-问题" tabindex="-1"><a class="header-anchor" href="#缓存击穿-热点key-问题" aria-hidden="true">#</a> 缓存击穿（热点key）问题</h2><p>热点key：在<strong>某一时间段</strong>会被****高并发访问**，缓存重建<strong>耗时较长</strong></p><p>缓存击穿问题也叫热点Key问题，就是一个被高并发访问并且缓存重建业务较复杂的key突然失效了，无数的请求访问会在瞬间给数据库带来巨大的冲击。</p><hr><blockquote><p>逻辑分析：假设线程1在查询缓存之后，本来应该去查询数据库，然后把这个数据重新加载到缓存的，此时只要线程1走完这个逻辑，其他线程就都能从缓存中加载这些数据了，但是<strong>假设在线程1没有走完</strong>的时候，<strong>后续的线程</strong>2，线程3，线程4<strong>同时</strong>过来<strong>访问</strong>当前这个方法， 那么这些线程都不能从缓存中查询到数据，那么他们就会同一时刻来访问查询缓存，都没查到，接着<strong>同一时间去访问数据库</strong>，同时的去执行数据库代码，对<strong>数据库访问压力过大</strong></p></blockquote><figure><img src="'+b+'" alt="缓存击穿逻辑分析" tabindex="0" loading="lazy"><figcaption>缓存击穿逻辑分析</figcaption></figure><hr><p>解决方案</p><ol><li>互斥锁：</li></ol>',14),F=n("li",null,"思路：给缓存重建过程加锁，确保重建过程只有一个线程执行，其他线程等待。",-1),L=n("blockquote",null,[n("p",null,"实战篇中，通过redis的setnx来判断是否有线程进行数据重建")],-1),O=n("ol",{start:"2"},[n("li",null,"逻辑过期：")],-1),_=n("li",null,[s("思路： "),n("ul",null,[n("li",null,"热点key缓存永不过期，而是设置一个逻辑过期时间，查询到数据时通过对逻辑时间判断，来决定是否需要重建数据。"),n("li",null,"重建缓存也是通过互斥锁保证单线程执行。"),n("li",null,"重建缓存使用独立线程异步执行。"),n("li",null,"其他线程无需等待，直接查询旧数据返回即可。")])],-1),K=n("h2",{id:"缓存工具类",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#缓存工具类","aria-hidden":"true"},"#"),s(" 缓存工具类")],-1),A=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{class:"language-java"},[n("code",null,[n("span",{class:"token keyword"},"package"),s(),n("span",{class:"token namespace"},[s("com"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token operator"},"*"),n("span",{class:"token punctuation"},"."),s("*"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("cn"),n("span",{class:"token punctuation"},"."),s("hutool"),n("span",{class:"token punctuation"},"."),s("core"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"BooleanUtil")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("cn"),n("span",{class:"token punctuation"},"."),s("hutool"),n("span",{class:"token punctuation"},"."),s("core"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"StrUtil")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("cn"),n("span",{class:"token punctuation"},"."),s("hutool"),n("span",{class:"token punctuation"},"."),s("json"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"JSONObject")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("cn"),n("span",{class:"token punctuation"},"."),s("hutool"),n("span",{class:"token punctuation"},"."),s("json"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"JSONUtil")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("lombok"),n("span",{class:"token punctuation"},"."),s("extern"),n("span",{class:"token punctuation"},"."),s("slf4j"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Slf4j")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("data"),n("span",{class:"token punctuation"},"."),s("redis"),n("span",{class:"token punctuation"},"."),s("core"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"StringRedisTemplate")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("org"),n("span",{class:"token punctuation"},"."),s("springframework"),n("span",{class:"token punctuation"},"."),s("stereotype"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Component")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("time"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"LocalDateTime")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},"."),s("concurrent"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"ScheduledThreadPoolExecutor")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},"."),s("concurrent"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"TimeUnit")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"import"),s(),n("span",{class:"token import"},[n("span",{class:"token namespace"},[s("java"),n("span",{class:"token punctuation"},"."),s("util"),n("span",{class:"token punctuation"},"."),s("function"),n("span",{class:"token punctuation"},".")]),n("span",{class:"token class-name"},"Function")]),n("span",{class:"token punctuation"},";"),s(`


`),n("span",{class:"token doc-comment comment"},`/**
 * @Author 帅博文
 * @Date 2023/11/23 17:03
 * @Version 1.0
 */`),s(`
`),n("span",{class:"token annotation punctuation"},"@Component"),s(`
`),n("span",{class:"token annotation punctuation"},"@Slf4j"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"CacheClient"),s(),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"final"),s(),n("span",{class:"token class-name"},"StringRedisTemplate"),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token keyword"},"final"),s(),n("span",{class:"token class-name"},"ScheduledThreadPoolExecutor"),s(),n("span",{class:"token constant"},"CACHE_REBUILD_POOL"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token class-name"},"CacheClient"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StringRedisTemplate"),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"this"),n("span",{class:"token punctuation"},"."),s("stringRedisTemplate "),n("span",{class:"token operator"},"="),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token keyword"},"static"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token keyword"},"int"),s(" corePoolSize "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"int"),s(" maximumPoolSize "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"long"),s(" keepAliveTime "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"60L"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"TimeUnit"),s(" unit "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"TimeUnit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"SECONDS"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token constant"},"CACHE_REBUILD_POOL"),s(),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"ScheduledThreadPoolExecutor"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token constant"},"CACHE_REBUILD_POOL"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setMaximumPoolSize"),n("span",{class:"token punctuation"},"("),s("maximumPoolSize"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token constant"},"CACHE_REBUILD_POOL"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setKeepAliveTime"),n("span",{class:"token punctuation"},"("),s("keepAliveTime"),n("span",{class:"token punctuation"},","),s(" unit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 存入redis，带有ttl
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"value"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"expireTime"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"unit"),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),s(" value"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Long"),s(" expireTime"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(" unit"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toJsonStr"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" expireTime"),n("span",{class:"token punctuation"},","),s(" unit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 存入reids，带有逻辑过期时间
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"value"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"expireTime"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"unit"),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"setWithLogicalExpire"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Object"),s(" value"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Long"),s(" expireTime"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(" unit"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"RedisData"),s(" redisData "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"RedisData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        redisData`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setData"),n("span",{class:"token punctuation"},"("),s("value"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        redisData`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setExpireTime"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"LocalDateTime"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"now"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"plusSeconds"),n("span",{class:"token punctuation"},"("),s("unit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toSeconds"),n("span",{class:"token punctuation"},"("),s("expireTime"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toJsonStr"),n("span",{class:"token punctuation"},"("),s("redisData"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 获取redis数据，未命中时返回空对象
     * 避免缓存穿透
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"keyPrefix"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"id"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"type"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"dbFallBack"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"expireTime"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"unit"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"<"),s("R"),n("span",{class:"token punctuation"},">")]),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},">")]),s(`
     * `),n("span",{class:"token keyword"},"@return"),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},","),s(" ID"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token class-name"},"R"),s(),n("span",{class:"token function"},"queryWithPassThrough"),n("span",{class:"token punctuation"},"("),s(`
            `),n("span",{class:"token class-name"},"String"),s(" keyPrefix"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ID"),s(" id"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Class"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},">")]),s(" type"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Function"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},">")]),s(" dbFallBack"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"Long"),s(" expireTime"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(" unit"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" key "),n("span",{class:"token operator"},"="),s(" keyPrefix "),n("span",{class:"token operator"},"+"),s(" id"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" json "),n("span",{class:"token operator"},"="),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token comment"},"// 命中redis，且不为空"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StrUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isNotBlank"),n("span",{class:"token punctuation"},"("),s("json"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBean"),n("span",{class:"token punctuation"},"("),s("json"),n("span",{class:"token punctuation"},","),s(" type"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token comment"},"// 命中为空时"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("json "),n("span",{class:"token operator"},"!="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token class-name"},"R"),s(" r "),n("span",{class:"token operator"},"="),s(" dbFallBack"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),s("id"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 查询db，不存在，缓存空对象"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("r "),n("span",{class:"token operator"},"=="),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},","),s(" expireTime"),n("span",{class:"token punctuation"},","),s(" unit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token comment"},"// 存在，数据重建"),s(`
        stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toJsonStr"),n("span",{class:"token punctuation"},"("),s("r"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" expireTime"),n("span",{class:"token punctuation"},","),s(" unit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" r"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`


    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 获取redis 热点数据
     * 通过逻辑过期时间，避免缓存击穿问题
     * 前提：热点key会提前放到redis中
     * 默认：认为未命中redis的，不是本次的热点key
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"keyPrefix"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"id"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"type"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"dbFallBack"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"time"),s(`       逻辑过期时长
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"unit"),s(`       逻辑过期时间单位
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"lockKey"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"lockTime"),s(`   redis锁过期时间
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"lockUnit"),s(`   redis锁过期时间单位
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"<"),s("R"),n("span",{class:"token punctuation"},">")]),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},">")]),s(`
     * `),n("span",{class:"token keyword"},"@return"),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},","),s(" ID"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token class-name"},"R"),s(),n("span",{class:"token function"},"queryWithLogicalExpire"),n("span",{class:"token punctuation"},"("),s(`
            `),n("span",{class:"token class-name"},"String"),s(" keyPrefix"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ID"),s(" id"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Class"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},">")]),s(" type"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Function"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},">")]),s(" dbFallBack"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"Long"),s(" time"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(" unit"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"String"),s(" lockKey"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Long"),s(" lockTime"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(` lockUnit
    `),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" key "),n("span",{class:"token operator"},"="),s(" keyPrefix "),n("span",{class:"token operator"},"+"),s(" id"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"String"),s(" json "),n("span",{class:"token operator"},"="),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StrUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isBlank"),n("span",{class:"token punctuation"},"("),s("json"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token class-name"},"RedisData"),s(" redisData "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBean"),n("span",{class:"token punctuation"},"("),s("json"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"RedisData"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"LocalDateTime"),s(" expireTime "),n("span",{class:"token operator"},"="),s(" redisData"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getExpireTime"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token class-name"},"R"),s(" r "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBean"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"JSONObject"),n("span",{class:"token punctuation"},")"),s(" redisData"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" type"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

        `),n("span",{class:"token comment"},"// 未过期，直接返回"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("expireTime"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isAfter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"LocalDateTime"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"now"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(" r"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token comment"},"// 过期，数据重建"),s(`
        `),n("span",{class:"token keyword"},"boolean"),s(" lock "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token function"},"tryLock"),n("span",{class:"token punctuation"},"("),s("lockKey"),n("span",{class:"token punctuation"},","),s(" lockTime"),n("span",{class:"token punctuation"},","),s(" lockUnit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 获取锁失败，直接返回旧数据"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token operator"},"!"),s("lock"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(" r"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        `),n("span",{class:"token comment"},"// 获取锁成功，DoubleCheck"),s(`
        json `),n("span",{class:"token operator"},"="),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"get"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"StrUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isBlank"),n("span",{class:"token punctuation"},"("),s("json"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`
        redisData `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBean"),n("span",{class:"token punctuation"},"("),s("json"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"RedisData"),n("span",{class:"token punctuation"},"."),n("span",{class:"token keyword"},"class"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        expireTime `),n("span",{class:"token operator"},"="),s(" redisData"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getExpireTime"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        r `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toBean"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"JSONObject"),n("span",{class:"token punctuation"},")"),s(" redisData"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},","),s(" type"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"if"),s(),n("span",{class:"token punctuation"},"("),s("expireTime"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isAfter"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"LocalDateTime"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"now"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"return"),s(" r"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token comment"},"// 数据重建"),s(`
        `),n("span",{class:"token constant"},"CACHE_REBUILD_POOL"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"submit"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"->"),s(),n("span",{class:"token punctuation"},"{"),s(`
            `),n("span",{class:"token keyword"},"try"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token function"},"saveObject2Redis"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(" id"),n("span",{class:"token punctuation"},","),s(" time"),n("span",{class:"token punctuation"},","),s(" dbFallBack"),n("span",{class:"token punctuation"},","),s(" unit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"catch"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"InterruptedException"),s(" e"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
                log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"error"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"saveShop2Redis error: "'),n("span",{class:"token punctuation"},","),s(" e"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
                `),n("span",{class:"token keyword"},"throw"),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"RuntimeException"),n("span",{class:"token punctuation"},"("),s("e"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(),n("span",{class:"token keyword"},"finally"),s(),n("span",{class:"token punctuation"},"{"),s(`
                `),n("span",{class:"token function"},"unLock"),n("span",{class:"token punctuation"},"("),s("lockKey"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
            `),n("span",{class:"token punctuation"},"}"),s(`

        `),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 保存对象到redis中，并设置逻辑过期时间
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"key"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"id"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"expireSeconds"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"dbFallBack"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"unit"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},">")]),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token class-name"},[n("span",{class:"token punctuation"},"<"),s("R"),n("span",{class:"token punctuation"},">")]),s(`
     * `),n("span",{class:"token keyword"},"@throws"),s(),n("span",{class:"token reference"},[n("span",{class:"token class-name"},"InterruptedException")]),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},">")]),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"saveObject2Redis"),n("span",{class:"token punctuation"},"("),s(`
            `),n("span",{class:"token class-name"},"String"),s(" key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"ID"),s(" id"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Long"),s(" expireSeconds"),n("span",{class:"token punctuation"},","),s(`
            `),n("span",{class:"token class-name"},"Function"),n("span",{class:"token generics"},[n("span",{class:"token punctuation"},"<"),s("ID"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"R"),n("span",{class:"token punctuation"},">")]),s(" dbFallBack"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(" unit"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token keyword"},"throws"),s(),n("span",{class:"token class-name"},"InterruptedException"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token comment"},"// 查询数据库"),s(`
        `),n("span",{class:"token class-name"},"R"),s(" r "),n("span",{class:"token operator"},"="),s(" dbFallBack"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"apply"),n("span",{class:"token punctuation"},"("),s("id"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 模拟重建数据延迟"),s(`
        `),n("span",{class:"token class-name"},"Thread"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"sleep"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"200"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 创建redisData对象"),s(`
        `),n("span",{class:"token class-name"},"RedisData"),s(" redisData "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token class-name"},"RedisData"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        redisData`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setData"),n("span",{class:"token punctuation"},"("),s("r"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        redisData`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setExpireTime"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"LocalDateTime"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"now"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"plusSeconds"),n("span",{class:"token punctuation"},"("),s("unit"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toSeconds"),n("span",{class:"token punctuation"},"("),s("expireSeconds"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token comment"},"// 存入redis"),s(`
        stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"set"),n("span",{class:"token punctuation"},"("),s("key"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"JSONUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"toJsonStr"),n("span",{class:"token punctuation"},"("),s("redisData"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 通过setnx，来限制单线程重建数据
     * 根据lockKey，设置锁过期时间
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"lockKey"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"expireTime"),s(`
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"unit"),s(`
     * `),n("span",{class:"token keyword"},"@return"),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"boolean"),s(),n("span",{class:"token function"},"tryLock"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" lockKey"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"Long"),s(" expireTime"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"TimeUnit"),s(" unit"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        `),n("span",{class:"token class-name"},"Boolean"),s(" flag "),n("span",{class:"token operator"},"="),s(" stringRedisTemplate"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"opsForValue"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"setIfAbsent"),n("span",{class:"token punctuation"},"("),s("lockKey"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},'"1"'),n("span",{class:"token punctuation"},","),s(" expireTime"),n("span",{class:"token punctuation"},","),s(" unit"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
        `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token class-name"},"BooleanUtil"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"isTrue"),n("span",{class:"token punctuation"},"("),s("flag"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

    `),n("span",{class:"token doc-comment comment"},[s(`/**
     * 释放redis锁
     *
     * `),n("span",{class:"token keyword"},"@param"),s(),n("span",{class:"token parameter"},"lockKey"),s(`
     */`)]),s(`
    `),n("span",{class:"token keyword"},"private"),s(),n("span",{class:"token keyword"},"void"),s(),n("span",{class:"token function"},"unLock"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"String"),s(" lockKey"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
        stringRedisTemplate`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"delete"),n("span",{class:"token punctuation"},"("),s("lockKey"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token punctuation"},"}"),s(`

`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1);function N(I,P){const t=o("Badge"),c=o("CodeDemo"),p=o("FlowChart");return u(),k("div",null,[y,n("ol",null,[n("li",null,[a(t,{text:"每台服务器中都有完整的一份session数据，服务器压力过大。",type:"warning",vertical:"middle"})]),n("li",null,[a(t,{text:"session拷贝数据时，可能会出现延迟",type:"warning",vertical:"middle"})])]),g,a(t,{text:"策略选择",type:"tip",vertical:"middle"}),f,w,n("ul",null,[n("li",null,[n("p",null,[s("Cache Aside：缓存调用者在更新数据库的同时完成对缓存的更新。 "),a(t,{text:"一致性良好",type:"tip",vertical:"middle"}),s(),a(t,{text:"实现难度一般",type:"tip",vertical:"middle"})])]),n("li",null,[n("p",null,[s("Read/Write Through：缓存与数据库集成一个服务，服务保证两者的一致性，对外暴露API调用接口。调用者调用API，无需知道自己操作的是数据库还是缓存，不关心一致性。 "),a(t,{text:"一致性优秀",type:"tip",vertical:"middle"}),s(),a(t,{text:"实现复杂",type:"tip",vertical:"middle"}),s(),a(t,{text:"性能一般",type:"tip",vertical:"middle"})])]),n("li",null,[n("p",null,[s("Write Back：缓存调用者的CRUD都针对缓存完成。由独立线程异步的将缓存数据写到数据库，实现最终一致性 "),a(t,{text:"一致性差",type:"tip",vertical:"middle"}),s(),a(t,{text:"实现复杂",type:"tip",vertical:"middle"}),s(),a(t,{text:"性能好",type:"tip",vertical:"middle"})])])]),h,a(t,{text:"最佳实践",type:"note",vertical:"middle"}),a(c,{id:"code-demo-184",type:"normal",title:"%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%97%B6",code:"eJydks9KAlEUxl/lMKsZCN0XblwEGShktZrN/LnpjNOMzB0DEZdBRIFhCyHRigyKTIQWakov44yz6xW6d+7cSWoRtBqYc853ft93bkMwlRNF2BQA0mkIbqfB5WsF1YP+IBzdu0g38Of8IuiM/Najf7VYToayDVD0XMMuAS471Rx2bMgAjv7s0f59dFy1FA+lnCredtxDxaohUUqVkCfKgqZoZbSL6rIgbck21TKOQCR6B55hpQycd7yspdgVkWtLEjRoW4QX8TAMQmWScrh4WU5mjmqGH9f+TY91usiruTbkioV8JOs5WaTYieQGFFQTaV5KsxSMKQdAk8HwHUH3OVnDotBVWmeDQPbRTwaIqWx9RxcNndshCrq6Ps7A/Idx+Dbgfvl8BuyaZSUO2Qn47Gre9oed1dPMH03D8R1v+Ttp/CPpDZAFlneyhEH90o6Do1A8ldhRYocg+aeD5GGctfzz/nf2/4FbOxO9DnkLcT4SQ05w2SFW7+2g16WFmJY1k1ah+QW42DOp"},{default:l(()=>[x]),_:1}),a(p,{id:"flowchart-187",code:"eJwrLrG1Ky5JLCqxUni6p+Hp8m6uVFu71LwUK4Xnuyc/mzufK7/A0NYuvyC1KLEkMz/PSuHZ/KUv1i96vmfy07UzgJJGKJIv9k95OnseSOe8OUBJYyw6n03d8Kx33dNdk4HyJijyTze0wSWhjLaZT1uXQu1Kzs9LsbUDkZlQ9R1Lnk1bC5F9NmP90wnLnk7c+2TH2vd75nNxFZfoAs021AVrAOvVyMvXBIkZQXiVqcU6CkWZ6RklYFFjEGGikZOaBuEbgfyma5fKBQAU3IiW",preset:"vue"}),a(c,{id:"code-demo-188",type:"normal",title:"%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6",code:"eJyrVspKLEtUslJSUNDXV3g2e8uzaRueTd3wrHfd012TY/IUFEoLUhJLUp0qPVM0ijPyCzStQYIgDFT+tGPBy5lLilJTMouf75n8dO0MkHhxSVFmXnoQSDAkNbcgB6hbLyU1J7UkVSNGKTkxOSPVO7UyRglhUFFqSWlRngKQr1QLAP2COWQ="},{default:l(()=>[T]),_:1}),a(p,{id:"flowchart-191",code:"eJwrLrG1Ky5JLCqxUni6p+Hp8m6uVFu71LwUK4Xnuyc/mzufK7/A0NYuvyC1KLEkMz/PSuHJ/nXPpux8NnXDs951T3dNBsobocg/7VjwcuaS53smP107AyhpjCL5fOG6J/vnPtmx5EVD69O++U/XTnjWsJyLq7hEF6jKEEQYgQhjXbtULgBhHUj6",preset:"vue"}),S,R,U,n("ul",null,[n("li",null,[D,n("ul",null,[B,n("li",null,[s("优点："),a(t,{text:"实现简单",type:"tip",vertical:"middle"}),s(),a(t,{text:"维护方便",type:"tip",vertical:"middle"})]),n("li",null,[s("缺点："),a(t,{text:"额外的内存消耗",type:"danger",vertical:"middle"}),s(),a(t,{text:"可能造成短期的不一致",type:"danger",vertical:"middle"})])])]),n("li",null,[E,n("ul",null,[j,n("li",null,[s("优点："),a(t,{text:"内存占用较少",type:"tip",vertical:"middle"}),s(),a(t,{text:"没有多余key",type:"tip",vertical:"middle"})]),n("li",null,[s("缺点："),a(t,{text:"实现复杂",type:"danger",vertical:"middle"}),s(),a(t,{text:"存在误判可能",type:"danger",vertical:"middle"})])])]),C]),J,n("ul",null,[F,n("li",null,[s("优点："),a(t,{text:"实现简单",type:"tip",vertical:"middle"}),s(),a(t,{text:"无额外内存消耗",type:"tip",vertical:"middle"}),s(),a(t,{text:"一致性较好",type:"tip",vertical:"middle"})]),n("li",null,[s("缺点："),a(t,{text:"线程等待导致性能下降",type:"danger",vertical:"middle"}),s(),a(t,{text:"存在死锁风险",type:"danger",vertical:"middle"})])]),L,O,n("ul",null,[_,n("li",null,[s("优点："),a(t,{text:"线程无需等待，性能较好",type:"tip",vertical:"middle"})]),n("li",null,[s("缺点："),a(t,{text:"不保证线程一致性",type:"danger",vertical:"middle"}),s(),a(t,{text:"有额外内存损耗",type:"danger",vertical:"middle"}),s(),a(t,{text:"实现复杂",type:"danger",vertical:"middle"})])]),K,a(c,{id:"code-demo-403",type:"normal",title:"%E7%A4%BA%E4%BE%8B",code:"eJzFWelvE0cU/1eGfFqn7uagaiUKiFyoQEpQDPSLJbRZj+0l6113j5AURYK2KBw1hzhCQ2gKIi0gCCBFNBfkn8munU/8C30zs8fseu04Ccd+sHZn3rxrfvPem+fzbWelMaltX1tZkkelAkayXhLbxfbvs1pWU0pl3bCQrIlF29J1VZR1A4u2pahiL3xiSTsF70DahDBjGY2Izpq6Jh7NDB0fGjmLZaspSZSHqpdG9FERj1vY0ERTzX9zVsyQ35BENwqiWTYUrZA3pBI+pxujYk6yJNHAOcVkCoJuMD9MBk7iUlmVLNycgQnysG5NlLHYpwOZhjWidrCG+FK0lBIWB3VZUvuB4Un4CplSAuoXWddk2zCAgZiRizhnqzh3smhgKXcCDB8YxzJ4wNhiJWF+SlM414VkeVuTLQXcd9h7oYpmtY729qyG2tGhHtsq6gZyli45lRn33hQbJTqj7s7uvR1dXR3de1HXd/s697Kp09gwgQ/qEjvJQEdWOxR4Ad7pBmS1sj2iKjKSVck0UZ8EtvWpClCg87AIHnDpGJGRVzRJRQlbgMzEbYmuNi3JAikek8YORH09fT8MnBke6D11ZLD/zImhocGQF9OU01FoUZ2Ubwx5rCLgKYEIHWhgCVk06SvhGcLxU8BXBJ7EjIzyC+HT1ekt8+dL0rhSskuNSFRdK6BRjMs9qjJGIQgU33YS030SHzrIJj8Hgm8xM9A3dLw/E3iJPPVOhBUaPtfM80JXZ4qTV89CNLH1Y9QOIWbX1gyO8UYKEZPT1DSfBXU4e2UngDztyHl537k0T2PCh7U/nKV/3NkrlqX68wHdobIEUQB8OhEfGpNUG8cH8XhZMagW8Rmikz8GJ4jD4Ziu5BCY5IGQyEojFhqZkDQaJPsa8k5HdzGCygToiXrZPKwbpwkvIUW8Bw4DGX58FS39KMRbEC9Qeal0RFadNxv5UsmFvty8sFp7f6u2PuXOzrnTbzenF7+ka39SrOKgXlAgNg9QNh/H19TLEDglRIFE39j5CGYEHsoBFdkDOsv83YiE6UoRHskroqafg40sq7aZwZAWcqZAdIN99D9D/VMpnv3u0BEoF/BscLpq1/9zbtyj5O7d125lAXDhzj53br3bWHoJcKit33Ee/FV9tuK8Wq69eRSs27y47lyqVNduA6Sqz9Y3L9xogpoTBs4r4/EJJRcfIWk7PpYbOSypai/UPjuDmT+2f/hg3dCRfm7MwJZt+BE1hs79w2kExGgY/WxjY4KA9AQkTwipul0oCuGukScELLObLAVj06iPJFzQg9qZRn7WBzXSCEZDS9NRhtvAeSgb4B1ogL4C+Ry2PCpSuiWnwBjSCgxpBEohk44OxFDih+aNpTsbS5WNpRVAC5cL84gcYYpPxTyuW72qpI0KRHYqojo7U2QPeED3QglLidPUa/wJAUTX6cKkA26jClBL98CBt1W1kVAyF+XOhQ9kgKPCDRKlclmdEJQcrw8o4c7N1149zo1Qb1RItJ19Cu/+MYkeIk834NxAsW2EgGxbtq1xLtiGpcSTvtosIGxOVZxVbkN3GZiapCxORVJWtxa1UPW3l9Vfl5muYXi6MAMZrT61gVV85HKmVknwml7YfHw/TJJXKu6Nmx/WZhhnsGRjbQZGyPid987l11QugC2Utnq/tvAEVsAvIDCIn5SwOvM7g4N7/5U7+8J98QhGAtafPWqSu4/n67h77q4nBdIGxNOLTuXuxrtKfImqy6PH6gsFMkyrXC9xbt65mFRy8OQ0wiWTJ4v+2CE+Wod8jiBPNicW3mNknlzPy14N5DuXW+o7kK3+UjkiGvxbiPxNg3BiDZecKwJakd5y+QgTqc+4WAS8wpIOrOFKOn45SwVxqULYJElF2bDSMsxe0Xwx+5zBmiSJB4vu9XlWb0U9GOoITuzJQ4cjqchs6FM/libF+kB6cqwfYT0kiiaw2jImQPCoEKAvBJ6Pt1hCZIEaTq/z5E1tcT5mpjv9byRue/buIcxatCZJlnv5pnOVGNWvw9nGfUUchEF4doLoj4jnuuvDTjC8bdTuDrOfCYzJGEzqKtgjJcUShBT6+mBcDmA0PkQeUxrDzNZu6ldWoJCAzWIuF5cTS6dJJEuWXETCEQ1MNuyyhXMD4zIuk+COou0m/1H1ggi00GjJthH5maJeZtIRHd4HZRtUQ3FRrGNl6OfY/dTWiIaBLKGOfpL12NREu22NP7F1S/kdmEyowzj8JjYUNtYfkjKKlrVcZUSaC8tvawvvq+8WdtVfqK92GP6823PrZU/ilTBSHCTUEHQXTJS05fEiwmt6+mmetTPimGtUQgTFA3fT8yyMpf8m5UT8VthEeR4owa2FnT5n5fYOrj1PH7nX5tjB9disQudgLiRizUf4HwDaf0J3Z6TvSK4clx/A0iAGxa9Ju+/eGJ+sc+N9RZs33i3Ka1t+4qZO/Eyyuw8w0sZJYn84v/nnTefyW6iZqyvr1afX+H0KFrl/L8OnFyZgmXd2k6v0Fmv+Vhs0yWW5d6L8EsSvPRIL4NaaI94/YiivSoWWKgDw4ZF8z4hJ/ncIBGbbura6a3vBk/sHDnLlSQN4EtHNN2/qKlwy/TtPiw6PuYwGHy/wR921Zf85h1Vs4Xi6oJrCT9vk/9aVBrk="},{default:l(()=>[A]),_:1})])}const Q=i(v,[["render",N],["__file","基础篇.html.vue"]]);export{Q as default};
